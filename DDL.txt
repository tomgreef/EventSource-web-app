
CREATE TABLE chats (
    id            INTEGER NOT NULL,
    fecha_y_hora  TIMESTAMP NOT NULL,
    usuarios_id   INTEGER NOT NULL,
    usuarios_id1  INTEGER NOT NULL
);

ALTER TABLE chats ADD CONSTRAINT chat_pk PRIMARY KEY ( id );

CREATE TABLE etiquetas (
    id         INTEGER NOT NULL,
    nombre     VARCHAR(40) NOT NULL,
    evento_id  INTEGER NOT NULL
);

ALTER TABLE etiquetas ADD CONSTRAINT etiquetas_pk PRIMARY KEY ( id );

ALTER TABLE etiquetas ADD CONSTRAINT etiquetas_nombre_un UNIQUE ( nombre );

CREATE TABLE eventos (
    id                            INTEGER NOT NULL,
    titulo                        VARCHAR(40) NOT NULL,
    descripcion                   VARCHAR(255) NOT NULL,
    fecha                         DATE NOT NULL,
    fecha_limite_reserva          DATE NOT NULL,
    coste                         FLOAT NOT NULL,
    aforo                         INTEGER NOT NULL,
    entradas_maximas_por_usuario  INTEGER NOT NULL,
    filas                         INTEGER,
    columnas                      INTEGER
);

ALTER TABLE eventos ADD CONSTRAINT evento_pk PRIMARY KEY ( id );

CREATE TABLE mensajes (
    chat_id       INTEGER NOT NULL,
    fecha_y_hora  TIMESTAMP NOT NULL,
    usuarios_id   INTEGER NOT NULL,
    mensaje       VARCHAR(255) NOT NULL
);

ALTER TABLE mensajes
    ADD CONSTRAINT mensajes_pk PRIMARY KEY ( chat_id,
                                             fecha_y_hora,
                                             usuarios_id );

CREATE TABLE reservas (
    id_reservas      INTEGER NOT NULL,
    evento_id        INTEGER NOT NULL,
    usuario_id       INTEGER NOT NULL,
    cantidad         INTEGER,
    asiento_fila     INTEGER,
    asiento_columna  INTEGER
);


ALTER TABLE reservas ADD CONSTRAINT reserva_pk PRIMARY KEY ( id_reservas );

CREATE TABLE usuarios (
    id         INTEGER NOT NULL,
    email      VARCHAR(40) NOT NULL,
    password   VARCHAR(60),
    nobmre     VARCHAR(40) NOT NULL,
    apellidos  VARCHAR(80) NOT NULL,
    domicilio  VARCHAR(80) NOT NULL,
    ciudad     VARCHAR(30) NOT NULL,
    edad       INTEGER NOT NULL,
    sexo       INTEGER NOT NULL,
    rol        INTEGER NOT NULL
);

ALTER TABLE usuarios ADD CONSTRAINT usuarios_pk PRIMARY KEY ( id );

ALTER TABLE chats
    ADD CONSTRAINT chat_usuarios_fk FOREIGN KEY ( usuarios_id )
        REFERENCES usuarios ( id );

ALTER TABLE chats
    ADD CONSTRAINT chat_usuarios_fkv1 FOREIGN KEY ( usuarios_id1 )
        REFERENCES usuarios ( id );

ALTER TABLE etiquetas
    ADD CONSTRAINT etiquetas_evento_fk FOREIGN KEY ( evento_id )
        REFERENCES eventos ( id );

ALTER TABLE mensajes
    ADD CONSTRAINT mensajes_chat_fk FOREIGN KEY ( chat_id )
        REFERENCES chats ( id );

ALTER TABLE mensajes
    ADD CONSTRAINT mensajes_usuarios_fk FOREIGN KEY ( usuarios_id )
        REFERENCES usuarios ( id );

ALTER TABLE reservas
    ADD CONSTRAINT reserva_evento_fk FOREIGN KEY ( evento_id )
        REFERENCES eventos ( id );

ALTER TABLE reservas
    ADD CONSTRAINT reserva_usuarios_fk FOREIGN KEY ( usuario_id )
        REFERENCES usuarios ( id );



